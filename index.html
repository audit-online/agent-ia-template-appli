<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agent IA Template – Dashboard Pro</title>

  <!-- React + Babel CDN (pas de build nécessaire) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* ------- RESET + LAYOUT AMÉLIORÉ ------- */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}.app-container{display:flex;height:100vh;overflow:hidden}
    .sidebar{width:60%;max-width:800px;min-width:600px;background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-right:1px solid rgba(255,255,255,.2);display:flex;flex-direction:column;box-shadow:2px 0 20px rgba(0,0,0,.1)}
    .sidebar-header{padding:25px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-bottom:1px solid rgba(255,255,255,.1)}
    .sidebar-header h1{font-size:1.5rem;font-weight:700;margin-bottom:8px}
    .sidebar-header p{opacity:.9;font-size:.9rem}
    .status-indicator{display:inline-flex;align-items:center;gap:8px;margin-top:15px;padding:8px 12px;background:rgba(255,255,255,.2);border-radius:20px;font-size:.8rem}
    .status-dot{width:8px;height:8px;border-radius:50%;background:#4ade80;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .chat-section{flex:1;display:flex;flex-direction:column;min-height:0}
    .chat-messages{flex:1;overflow-y:auto;padding:25px;background:#f8fafc;font-size:15px;line-height:1.6}
    .message{margin-bottom:20px;padding:20px;border-radius:12px;max-width:95%;word-wrap:break-word}
    .message.user{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;margin-left:auto;box-shadow:0 4px 12px rgba(102,126,234,.3)}
    .message.agent{background:#fff;border:1px solid #e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .input-area{padding:25px;background:#fff;border-top:1px solid #e5e7eb}
    .input-group{display:flex;gap:15px;align-items:end}
    .input-wrapper{flex:1;position:relative}
    .input-wrapper textarea{width:100%;min-height:60px;max-height:150px;padding:15px 20px;border:2px solid #e5e7eb;border-radius:12px;font-size:15px;font-family:inherit;resize:none;transition:all .2s;line-height:1.5}
    .input-wrapper textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
    .btn{padding:15px 30px;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:15px;transition:all .2s;display:inline-flex;align-items:center;gap:8px}
    .btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 4px 12px rgba(102,126,234,.3)}
    .btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,.4)}
    .btn-primary:disabled{opacity:.6;cursor:not-allowed}
    .templates-section{border-top:1px solid #e5e7eb;background:#f8fafc;max-height:250px;overflow-y:auto}
    .templates-header{padding:20px;background:#fff;border-bottom:1px solid #e5e7eb;font-weight:600;color:#374151;font-size:16px}
    .template-item{padding:20px;border-bottom:1px solid #e5e7eb;background:#fff;transition:all .2s;cursor:pointer}
    .template-item:hover{background:#f3f4f6}
    .template-name{font-weight:600;color:#111827;margin-bottom:8px;font-size:14px}
    .template-meta{font-size:12px;color:#6b7280;margin-bottom:12px}
    .template-actions{display:flex;gap:10px}
    .btn-small{padding:8px 16px;font-size:12px;border-radius:8px}
    .btn-outline{background:transparent;border:1px solid #d1d5db;color:#374151}
    .btn-outline:hover{background:#f3f4f6;border-color:#9ca3af}
    .btn-preview{background:#10b981;color:#fff;border:none}
    .btn-preview:hover{background:#059669}
    .main-content{flex:1;display:flex;flex-direction:column;background:#fff;position:relative;min-width:300px}
    .main-header{padding:20px 30px;background:#fff;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .main-title{font-size:1.3rem;font-weight:700;color:#111827}
    .main-controls{display:flex;gap:12px;align-items:center}
    .preview-area{flex:1;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .empty-state{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;color:#6b7280;text-align:center;padding:40px}
    .empty-state-icon{font-size:5rem;margin-bottom:25px;opacity:.6}
    .empty-state h3{font-size:1.8rem;margin-bottom:15px;color:#374151}
    .empty-state p{font-size:1.1rem;line-height:1.6;margin-bottom:25px}
    .empty-state .btn{margin-top:15px}
    .template-preview-card{background:#fff;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,.1);padding:30px;max-width:400px;text-align:center}
    .template-preview-card h4{font-size:1.3rem;color:#111827;margin-bottom:15px}
    .template-preview-card p{color:#6b7280;margin-bottom:25px;line-height:1.6}
    .loading-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10}
    .spinner{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:16px}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    @media(max-width:1200px){.sidebar{width:65%;min-width:500px}}
    @media(max-width:900px){.sidebar{width:100%;min-width:auto}.main-content{display:none}}
    @media(max-width:768px){.app-container{flex-direction:column}.sidebar{width:100%;height:100vh}.main-content{display:none}}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [templates, setTemplates] = useState([]);
      const [isGenerating, setIsGenerating] = useState(false);
      const [currentTemplate, setCurrentTemplate] = useState(null);
      const [viewMode, setViewMode] = useState('preview');
      const [deviceView, setDeviceView] = useState('desktop');
      const [apiStatus, setApiStatus] = useState('testing');

      /* –––––  démarrage ––––– */
      useEffect(() => {
        testAPI();
        setMessages([{
          id: 1,
          type: 'agent',
          content: 'Bonjour ! Je suis Claude, votre expert en création de sites web.\n\nAvec 15 ans d\'expérience dans le domaine, je peux vous accompagner pour :\n\n• Analyser les besoins précis de vos clients\n• Recommander les meilleures solutions techniques\n• Créer des templates sur-mesure optimisés\n• Vous conseiller sur les tendances actuelles\n\nParlez-moi de votre projet - quel type de client accompagnez-vous aujourd\'hui ?'
        }]);
      }, []);

      /* –––––  test API avec diagnostic complet ––––– */
      const testAPI = async () => {
        try {
          console.log('🔧 Test de l\'API Netlify...');
          const r = await fetch('/.netlify/functions/ai-chat', { 
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          console.log('📡 Statut de réponse:', r.status);
          console.log('📡 Headers de réponse:', r.headers);
          
          const responseText = await r.text();
          console.log('📡 Réponse brute:', responseText);
          
          if (r.ok) {
            try {
              const data = JSON.parse(responseText);
              console.log('✅ Réponse parsée:', data);
              setApiStatus('working');
              setMessages(prev => [...prev, { 
                id: Date.now(), 
                type: 'agent', 
                content: `✅ API Netlify OK – prêt pour Claude.\n🔑 Clé API: ${data.hasAnthropicKey ? 'Configurée (' + (data.keyLength || 0) + ' caractères)' : 'MANQUANTE ❌'}\n📊 Timestamp: ${data.timestamp}` 
              }]);
            } catch (parseError) {
              console.error('❌ Erreur parsing JSON:', parseError);
              setApiStatus('broken');
              setMessages(prev => [...prev, { 
                id: Date.now(), 
                type: 'agent', 
                content: `⚠️ API répond mais JSON invalide.\nRéponse: ${responseText.substring(0, 200)}...` 
              }]);
            }
          } else {
            console.error('❌ Erreur HTTP:', r.status, responseText);
            setApiStatus('broken');
            setMessages(prev => [...prev, { 
              id: Date.now(), 
              type: 'agent', 
              content: `❌ API erreur ${r.status}\n📝 Réponse: ${responseText}\n\n🔧 Vérifiez:\n• Variables d'environnement Netlify\n• Logs de la fonction\n• Syntaxe du code` 
            }]);
          }
        } catch (networkError) {
          console.error('❌ Erreur réseau complète:', networkError);
          setApiStatus('broken');
          setMessages(prev => [...prev, { 
            id: Date.now(), 
            type: 'agent', 
            content: `❌ Erreur réseau: ${networkError.message}\n\n🔧 Causes possibles:\n• Fonction Netlify non déployée\n• URL incorrecte\n• Problème CORS\n• Timeout serveur` 
          }]);
        }
      };

      // Analyser le sentiment/contexte utilisateur
      const analyzeSentiment = (message) => {
        const positive = ['oui', 'parfait', 'excellent', 'super', 'génial', 'j aime'];
        const negative = ['non', 'pas', 'problème', 'difficile', 'compliqué'];
        const urgent = ['rapide', 'vite', 'urgent', 'maintenant', 'aujourd hui'];
        
        const lower = message.toLowerCase();
        return {
          isPositive: positive.some(word => lower.includes(word)),
          isNegative: negative.some(word => lower.includes(word)),
          isUrgent: urgent.some(word => lower.includes(word))
        };
      };

      // Detecter le niveau d'expertise du client avec historique complet
      const detectClientLevel = (fullConversation) => {
        const techTerms = ['responsive', 'seo', 'ux', 'ui', 'cms', 'api', 'ssl', 'framework', 'bootstrap', 'javascript', 'css', 'html'];
        const basicTerms = ['simple', 'facile', 'basique', 'je ne sais pas', 'débutant', 'pas technique', 'aidez-moi'];
        
        const allText = fullConversation.map(msg => msg.content).join(' ').toLowerCase();
        const techScore = techTerms.reduce((score, term) => allText.includes(term) ? score + 1 : score, 0);
        const basicScore = basicTerms.reduce((score, term) => allText.includes(term) ? score + 1 : score, 0);
        
        if (techScore > basicScore && techScore >= 2) return 'expert';
        if (basicScore > techScore && basicScore >= 1) return 'débutant';
        return 'intermédiaire';
      };

      /* –––––  envoi message INTELLIGENT avec VRAIE mémoire ––––– */
      const handleSendMessage = async () => {
        if (!inputMessage.trim()) return;
        
        const userMessage = { id: Date.now(), type: 'user', content: inputMessage };
        const messageContent = inputMessage;
        setInputMessage('');

        if (apiStatus !== 'working') {
          setMessages(prev => [...prev, userMessage, { 
            id: Date.now(), 
            type: 'agent', 
            content: 'API non disponible. Activez l\'API pour discuter avec l\'IA.' 
          }]);
          return;
        }

        // Ajouter le message utilisateur AVANT de commencer
        setMessages(prev => [...prev, userMessage]);
        setIsGenerating(true);

        try {
          // Construire l'historique COMPLET incluant le nouveau message
          const fullConversation = [...messages, userMessage];
          
          // Convertir en format Claude en filtrant le message d'accueil système
          const conversationHistory = fullConversation
            .filter(msg => msg.id !== 1) // Filtrer le message d'accueil initial
            .map(msg => ({
              role: msg.type === 'user' ? 'user' : 'assistant', 
              content: msg.content
            }));

          const contextInfo = {
            hasTemplate: !!currentTemplate,
            templateInfo: currentTemplate ? {
              name: currentTemplate.name,
              type: detectType(currentTemplate.userInput),
              source: currentTemplate.source
            } : null,
            conversationLength: conversationHistory.length,
            userSentiment: analyzeSentiment(messageContent),
            clientLevel: detectClientLevel(fullConversation)
          };

          const res = await fetch('/.netlify/functions/ai-chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              message: messageContent,
              conversationHistory: conversationHistory,
              context: contextInfo,
              systemPrompt: `Tu es Claude, un expert senior en création de sites web avec 15 ans d'expérience. Tu assistes des commerciaux pour créer des TEMPLATES HTML CONCRETS.

RÈGLE ABSOLUE - CRÉATION DE TEMPLATES :
Si l'utilisateur demande un template, un prototype, une application ou un site web, tu DOIS répondre avec du code HTML complet et fonctionnel. PAS de blabla, PAS d'explications sans code.

QUAND CRÉER UN TEMPLATE :
- Dès qu'on te demande "créer un template"
- Dès qu'on te demande "créer un prototype" 
- Dès qu'on te demande "créer une application"
- Dès qu'on te demande "créer un site pour..."
- Si l'utilisateur dit "je ne vois rien" après avoir demandé un template

FORMAT DE RÉPONSE TEMPLATE :
1. Une phrase courte : "Voici le template pour [projet]"
2. IMMÉDIATEMENT le code HTML complet (DOCTYPE → </html>)
3. PAS d'explications avant le code
4. Code avec CSS/JS inline, entièrement fonctionnel
5. Design moderne, responsive, interactif avec animations

EXIGENCES TECHNIQUES TEMPLATES :
- HTML5 complet avec DOCTYPE
- CSS moderne (flexbox, grid, animations)
- JavaScript vanilla pour interactivité
- Design responsive mobile-first
- Couleurs professionnelles
- Fonctionnalités réellement cliquables
- Navigation fonctionnelle entre sections
- Formulaires avec validation
- Effets hover et transitions

MÉMOIRE CONVERSATIONNELLE :
- Se souvenir de TOUT le contexte précédent
- Construire sur les échanges précédents
- Utiliser les informations données (type de client, secteur, besoins)

EXEMPLE BON COMPORTEMENT :
User: "créer un template pour restaurant"
Claude: "Voici le template restaurant interactif :

<!DOCTYPE html>
<html lang="fr">
[CODE HTML COMPLET FONCTIONNEL]
</html>"

EXEMPLE MAUVAIS COMPORTEMENT :
User: "créer un template"
Claude: "Je vais vous créer un super template avec plein de fonctionnalités..." [SANS CODE]

HISTORIQUE ACTUEL: ${JSON.stringify(conversationHistory, null, 2)}
Template actuel: ${contextInfo.hasTemplate ? JSON.stringify(contextInfo.templateInfo) : 'Aucun'}
Niveau client détecté: ${contextInfo.clientLevel}
Nombre d'échanges: ${contextInfo.conversationLength}

SI LA DERNIÈRE DEMANDE CONCERNE UN TEMPLATE/PROTOTYPE/APPLICATION ET QUE TU N'AS PAS ENCORE FOURNI DE CODE HTML, TU DOIS LE FAIRE MAINTENANT !`
            })
          });

          console.log('📡 Réponse fetch status:', res.status);
          console.log('📡 Réponse fetch headers:', res.headers);

          if (!res.ok) {
            const errorText = await res.text();
            console.error('❌ Erreur HTTP:', res.status, errorText);
            throw new Error(`HTTP ${res.status}: ${errorText.substring(0, 200)}`);
          }

          const data = await res.json();
          console.log('✅ Données reçues:', data);
          
          if (data.response.includes('<!DOCTYPE') || data.response.includes('<html')) {
            let html = data.response.replace(/```html\n?/g, '').replace(/```\n?/g, '').trim();
            if (!html.includes('</html>')) html += '</body></html>';
            if (!html.includes('<!DOCTYPE')) {
              html = '<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Template Expert</title></head><body>' + html + '</body></html>';
            }
            
            const template = createTemplate('Template expert basé sur nos discussions', html, 'ai-expert');
            setCurrentTemplate(template);
            
            setMessages(prev => [...prev, { 
              id: Date.now(), 
              type: 'agent', 
              content: 'Parfait ! J\'ai créé le template en tenant compte de tous nos échanges précédents. Il intègre les meilleures pratiques que nous avons discutées. Le template va s\'ouvrir automatiquement dans un nouvel onglet pour que vous puissiez le voir en plein écran !' 
            }]);

            // Ouvrir automatiquement dans un nouvel onglet
            setTimeout(() => {
              openTemplateInNewTab(template);
            }, 1000);
          } else {
            let enhancedResponse = data.response;
            
            // NE PAS proposer automatiquement de créer un template
            // Laisser l'IA gérer la logique de proposition naturellement
            
            setMessages(prev => [...prev, { 
              id: Date.now(), 
              type: 'agent', 
              content: enhancedResponse 
            }]);
          }
          
        } catch (error) {
          console.error('❌ Erreur complète:', error);
          let errorMessage = 'Je rencontre un problème technique. ';
          
          if (error.message.includes('500')) {
            errorMessage += 'Erreur serveur (500) - vérifiez les logs Netlify et la clé API Anthropic.';
          } else if (error.message.includes('fetch')) {
            errorMessage += 'Problème de connexion - vérifiez votre réseau.';
          } else {
            errorMessage += `Détails: ${error.message}`;
          }
          
          setMessages(prev => [...prev, { 
            id: Date.now(), 
            type: 'agent', 
            content: errorMessage + '\n\nJe garde bien sûr en mémoire tous nos échanges précédents sur votre projet.'
          }]);
        } finally {
          setIsGenerating(false);
        }
      };

      /* –––––  génération IA ultra-exigeante ––––– */
      const generateWithAI = async (userInput) => {
        setIsGenerating(true);
        try {
          const res = await fetch('/.netlify/functions/ai-chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              message: 'Crée un site haut-de-gamme et interactif pour : ' + userInput,
              systemPrompt: `
Return ONLY a single, valid, complete HTML file (DOCTYPE → </html>) respecting :
1. Premium design : modern typography, glassmorphism, smooth animations.
2. Interactive : burger menu, vanilla carousel, validated form, dark/light switch.
3. Responsive : mobile-first, 320 px → 4 K.
4. No external links : CSS/JS inline, fonts via @font-face or system stack.
5. Accessibility : semantic tags, aria-labels, WCAG 2.1.
6. SEO : meta, Open-Graph, JSON-LD.
7. Performance : inline critical CSS, lazy images, no comment.
End with </html>, no markdown fences.
`
            })
          });
          if (!res.ok) throw new Error('Erreur IA');
          let html = (await res.json()).response
            .replace(/```html\n?/g, '')
            .replace(/```\n?/g, '')
            .trim();
          if (!html.includes('</html>')) html += '</body></html>';
          if (!html.includes('<!DOCTYPE')) {
            html = '<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Template</title></head><body>' + html + '</body></html>';
          }
          const template = createTemplate(userInput, html, 'ai');
          setCurrentTemplate(template);
          setMessages(prev => [...prev, { id: Date.now(), type: 'agent', content: '✨ Template premium généré ! Prévisualisation disponible.' }]);
        } catch (error) {
          console.error('Erreur IA:', error);
          generateTestTemplate(userInput);
        } finally {
          setIsGenerating(false);
        }
      };

      /* –––––  template test ––––– */
      const generateTestTemplate = (userInput) => {
        const html = createTestHTML(userInput);
        const template = createTemplate(userInput, html, 'test');
        setCurrentTemplate(template);
      };

      const createTestHTML = (input) => {
        const type = detectType(input);
        return `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Template ${type}</title><style>@font-face{font-family:Poppins;src:url(data:font/woff2;base64,...) format('woff2');font-display:swap}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Poppins,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.container{max-width:1200px;margin:auto;text-align:center;padding:40px 20px}.content{background:rgba(255,255,255,.95);color:#2c3e50;padding:60px;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1)}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;margin-top:40px}.card{background:#fff;padding:40px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.1);transition:.3s}.card:hover{transform:translateY(-10px)}.card h3{color:#e74c3c;margin-bottom:15px}</style></head><body><div class="container"><h1>Template ${type.toUpperCase()}</h1><p>Demande : ${input}</p><div class="content"><h2>Template Professionnel</h2><div class="grid"><div class="card"><h3>Design Premium</h3><p>Animations fluides & design responsive.</p></div><div class="card"><h3>Performance</h3><p>Code optimisé & UX exceptionnelle.</p></div><div class="card"><h3>Multi-device</h3><p>Adapté mobiles, tablettes & desktop.</p></div></div></div></div></body></html>`;
      };

      const detectType = (input) => {
        const lower = input.toLowerCase();
        if (lower.includes('restaurant') || lower.includes('café') || lower.includes('food')) return 'restaurant';
        if (lower.includes('boutique') || lower.includes('ecommerce') || lower.includes('shop')) return 'ecommerce';
        if (lower.includes('portfolio') || lower.includes('artiste') || lower.includes('photo')) return 'portfolio';
        if (lower.includes('agence') || lower.includes('cabinet') || lower.includes('avocat')) return 'business';
        return 'moderne';
      };

      const createTemplate = (userInput, htmlCode, source) => {
        const template = {
          id: Date.now(),
          name: `Template ${detectType(userInput)} – ${new Date().toLocaleTimeString()}`,
          userInput,
          htmlCode,
          source,
          createdAt: new Date()
        };
        setTemplates(prev => [template, ...prev]);
        return template;
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSendMessage();
        }
      };

      const openTemplateInNewTab = (template) => {
        const blob = new Blob([template.htmlCode], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        window.open(url, '_blank');
        // Nettoyer l'URL après 1 seconde
        setTimeout(() => URL.revokeObjectURL(url), 1000);
      };

      const downloadTemplate = (template) => {
        const blob = new Blob([template.htmlCode], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `template-${template.id}.html`;
        a.click();
        URL.revokeObjectURL(url);
      };

      return (
        React.createElement('div', { className: 'app-container' },
          React.createElement('div', { className: 'sidebar' },
            React.createElement('div', { className: 'sidebar-header' },
              React.createElement('h1', null, 'Agent IA Template'),
              React.createElement('p', null, 'Dashboard Professionnel'),
              React.createElement('div', { className: 'status-indicator' },
                React.createElement('div', { className: 'status-dot' }),
                apiStatus === 'working' ? 'IA Claude Active' : 'Mode Test'
              )
            ),
            React.createElement('div', { className: 'chat-section' },
              React.createElement('div', { className: 'chat-messages' },
                messages.map(msg => React.createElement('div', { key: msg.id, className: `message ${msg.type}` },
                  React.createElement('div', { style: { whiteSpace: 'pre-line' } }, msg.content)
                )),
                isGenerating && React.createElement('div', { className: 'message agent' },
                  React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: 10 } },
                    React.createElement('div', { style: { fontSize: '14px', opacity: 0.7 } }, 'Claude réfléchit et analyse...'),
                    React.createElement('div', { className: 'spinner', style: { width: 20, height: 20 } })
                  )
                )
              ),
              React.createElement('div', { className: 'input-area' },
                React.createElement('div', { className: 'input-group' },
                  React.createElement('div', { className: 'input-wrapper' },
                    React.createElement('textarea', {
                      value: inputMessage,
                      onChange: e => setInputMessage(e.target.value),
                      onKeyPress: handleKeyPress,
                      placeholder: currentTemplate ? 
                        'Que souhaitez-vous ajuster sur le template ? Je peux tout modifier...' : 
                        'Décrivez-moi votre client et son projet en détail...',
                      disabled: isGenerating
                    })
                  ),
                  React.createElement('button', {
                    onClick: handleSendMessage,
                    disabled: !inputMessage.trim() || isGenerating,
                    className: 'btn btn-primary'
                  }, currentTemplate ? 'Modifier' : 'Discuter')
                )
              )
            ),
            templates.length > 0 && React.createElement('div', { className: 'templates-section' },
              React.createElement('div', { className: 'templates-header' }, `Templates (${templates.length})`),
              templates.slice(0, 5).map(t => React.createElement('div', {
                key: t.id,
                className: 'template-item',
                onClick: () => setCurrentTemplate(t)
              },
                React.createElement('div', { className: 'template-name' }, t.name),
                React.createElement('div', { className: 'template-meta' }, `${t.userInput.substring(0, 50)}… | ${t.source}`),
                React.createElement('div', { className: 'template-actions' },
                  React.createElement('button', { 
                    className: 'btn btn-small btn-preview', 
                    onClick: e => { 
                      e.stopPropagation(); 
                      openTemplateInNewTab(t);
                    } 
                  }, '🚀 Ouvrir'),
                  React.createElement('button', { 
                    className: 'btn btn-small btn-outline', 
                    onClick: e => { 
                      e.stopPropagation(); 
                      setCurrentTemplate(t); 
                    } 
                  }, '👁️ Sélectionner'),
                  React.createElement('button', { 
                    className: 'btn btn-small btn-outline', 
                    onClick: e => { 
                      e.stopPropagation(); 
                      downloadTemplate(t); 
                    } 
                  }, '💾 DL')
                )
              ))
            )
          ),
          React.createElement('div', { className: 'main-content' },
            React.createElement('div', { className: 'main-header' },
              React.createElement('h1', { className: 'main-title' }, 'Aperçu Templates'),
              React.createElement('div', { className: 'main-controls' },
                React.createElement('div', { style: { fontSize: '14px', color: '#6b7280' } }, 
                  currentTemplate ? 'Template sélectionné' : 'Gestion des templates'
                )
              )
            ),
            React.createElement('div', { className: 'preview-area' },
              !currentTemplate && React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, '🎨'),
                React.createElement('h3', null, 'Espace de Gestion Templates'),
                React.createElement('p', null, 'Discutez avec l\'IA pour créer des templates professionnels.'),
                React.createElement('p', { style: { marginTop: '10px', fontSize: '14px' } }, 'Les templates générés s\'ouvriront automatiquement dans de nouveaux onglets.')
              ),
              currentTemplate && React.createElement('div', { className: 'template-preview-card' },
                React.createElement('h4', null, currentTemplate.name),
                React.createElement('p', null, 'Template créé avec succès ! Cliquez sur "Ouvrir" pour le voir en plein écran dans un nouvel onglet.'),
                React.createElement('div', { style: { display: 'flex', gap: '15px', justifyContent: 'center' } },
                  React.createElement('button', { 
                    className: 'btn btn-preview', 
                    onClick: () => openTemplateInNewTab(currentTemplate)
                  }, '🚀 Ouvrir'),
                  React.createElement('button', { 
                    className: 'btn btn-outline', 
                    onClick: () => downloadTemplate(currentTemplate)
                  }, '💾 Télécharger')
                )
              ),
              isGenerating && React.createElement('div', { className: 'loading-overlay' },
                React.createElement('div', { className: 'spinner' }),
                React.createElement('p', null, 'Génération du template en cours…'),
                React.createElement('p', { style: { fontSize: 14, opacity: .7, marginTop: 8 } }, 'IA Claude en action')
              )
            )
          )
        )
      );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>